<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pusat Kelola</title>
    <style>
      body {
          display: flex;
          font-family: Arial, sans-serif;
          margin: 0;
          padding: 0;
          height: 100vh; /* Pastikan tinggi body sesuai layar */
          overflow: hidden; /* Mencegah scroll pada seluruh halaman */
      }

      /* Sidebar */
      .sidebar {
          width: 200px;
          background-color: #333;
          color: white;
          padding: 20px;
          height: 100vh; /* Disesuaikan agar sidebar memiliki tinggi 100% layar */
          box-sizing: border-box;
      }

      .sidebar h2 {
          text-align: center;
          margin-bottom: 20px;
      }

      .sidebar ul {
          list-style-type: none;
          padding: 0;
      }

      .sidebar ul li {
          margin-bottom: 10px;
      }

      .sidebar ul li a {
          color: white;
          text-decoration: none;
          display: block;
          padding: 10px;
          background-color: #444;
          border-radius: 5px;
          transition: background-color 0.3s ease;
      }

      .sidebar ul li a:hover {
          background-color: #555;
      }

      /* Konten Utama */
      .main-content {
          flex-grow: 1;
          padding: 20px;
          overflow-y: auto;
      }

      .header {
          margin-bottom: 20px;
      }

      /* Tabel Konten */
      .content {
        overflow-x: auto; /* Scroll horizontal jika tabel lebih lebar */
        overflow-y: auto; /* Scroll vertikal jika data banyak */
        max-height: 300px; /* Atur tinggi maksimal agar tidak memenuhi seluruh layar */
        
      }
      .content table {
        width: 100%;
        border-collapse: collapse;
        border-radius: 8px; /* Membuat sudut tabel melengkung */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Memberikan efek bayangan */
      }
      .content thead {
        position: sticky;
        top: 0;
        background-color: #f2f2f2; /* Warna harus diatur agar tetap terlihat */
        z-index: 10;
      }

      
      .content table, .content th, .content td {
          border: 0px solid #ddd;
      }

      .content th, .content td {
        padding: 12px 16px; /* Spasi yang lebih besar untuk tampilan modern */
        text-align: left;
        border-bottom: 1px solid #ddd; /* Garis pembatas antar-baris */
      }

      .content tr:hover td {
      background-color: #f9f9f9; /* Warna latar belakang saat hover */
      }
  
      /* Loader */
      .loader {
          display: none;
          border: 4px solid #f3f3f3;
          border-radius: 50%;
          border-top: 4px solid #444;
          width: 30px;
          height: 30px;
          animation: spin 2s linear infinite;
          margin: auto; /* Pusatkan loader */
      }

      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }
      #map-container {
            margin-bottom: 20px;
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

      /* Pesan Kosong */
      .empty-message {
          text-align: center;
          margin-top: 20px;
          color: #888;
      }

      /* Scroll Menu untuk Tampilan Gambar */
      .scroll-menu {
          display: flex;
          flex-wrap: wrap;
          overflow-y: auto;
          gap: 20px;
          max-height: 300px;
          padding: 10px;
          border: 1px solid #ddd;
          border-radius: 10px;
          background-color: #fff;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      /* Styling scrollbar untuk semua browser */
      .scroll-menu::-webkit-scrollbar {
          width: 8px;
      }

      .scroll-menu::-webkit-scrollbar-thumb {
          background: #888;
          border-radius: 10px;
      }

      .scroll-menu::-webkit-scrollbar-track {
          background: #f1f1f1;
      }

      /* Scroll Item */
      .scroll-item {
          flex: 0 1 calc(23% - 20px); /* Mengatur lebar item untuk 4 kolom, memperhitungkan gap */
          text-align: center;
          cursor: pointer;
          background-color: #f8f8f8;
          padding: 15px;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          overflow: hidden;
          transition: transform 0.3s ease, box-shadow 0.3s ease;
          display: flex;
          flex-direction: column;
          height: auto;
      }

      .scroll-item img {
          width: 100%;
          height: 150px;
          object-fit: cover;
          border-radius: 8px;
          transition: transform 0.3s ease; /* Transisi halus untuk hover */
      }

      .scroll-item button {
          display: block;
          margin-top: 10px;
          padding: 8px 12px;
          background-color: #ff4d4d;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.3s ease;
      }

      .scroll-item button:hover {
          background-color: #ff1a1a;
      }

      .scroll-item p {
          margin: 10px 0;
          padding: 10px 15px;
          font-size: 14px;
          color: #333;
          line-height: 1.5;
          background-color: #fff;
          border-radius: 8px;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          flex-grow: 1;
          overflow: hidden;
          text-overflow: ellipsis;
          white-space: normal;
      }

      /* Hover Effect */
      .scroll-item:hover {
          transform: scale(1.05);
          box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      }

      .scroll-item:hover img {
          transform: scale(1.1); /* Efek zoom-in saat di-hover */
      }

      /* Media Query untuk Tampilan Mobile */
      @media (max-width: 768px) {
          body {
              flex-direction: column;
          }
          .sidebar {
              width: 100%;
              height: auto;
              padding: 10px;
              text-align: center;
          }
          .sidebar ul li {
              margin-bottom: 5px;
          }
          .main-content {
              padding: 10px;
          }
          .scroll-item {
              flex: 0 1 calc(50% - 20px); /* Menyesuaikan untuk 2 kolom di layar kecil */
          }
      }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>PUSAT KELOLA</h2>
        <ul>
            <li><a href="dashboard.html">Dashboard</a></li>
            <li><a href="admin.html">Admin</a></li>
            <li><a href="Petugas.html">Petugas</a></li>
            <li><a href="user.html">User</a></li>
            <li><a href="laporan.html">Laporan</a></li>
            <li><a href="uploadberita.html">Upload Berita</a></li>
            <li><a href="chrt.html">Chart Laporan</a></li>
            <li><a href="#" id="logout">Log Out</a></li>

        </ul>
    </div>

    <div class="main-content">
      <h1 class="menu-title">KANTOR PEMADAM KEBAKARAN</h1>
      <h2 class="menu-title">KOTA JAYAPURA</h2>
      <div id="map-container"></div>
      <div class="input-container">
        <label for="coordinates">Koordinat (Latitude, Longitude):</label>
        <input type="text" id="coordinates" placeholder="">
        <button id="show-location">Tampilkan Lokasi</button>
        <button id="route-location">Tampilkan Rute</button>
        <button id="clear-location">Bersihkan</button>
        <p id="distance-info">Jarak akan muncul di sini...</p>
       


      </div>
    <div class="main-content">
      <h2 class="menu-title">Berita Telah Diupload</h2>
       <div class="scroll-menu">
            <div class="scroll-item">
                <img src="https://via.placeholder.com/150" alt="Gambar">
                <p class="upload-note">Catatan</p>
                <button class="hapus-btn">Hapus</button> 
            </div>
        </div>
        <div class="scroll-menu" id="uploadsContainer">
        </div>
        <div class="header">
            <h2>User</h2>
        </div>
        <div class="content">
            <div class="loader" id="userLoader"></div>
            <table>
                <thead>
                    <tr>
                        <th>Nama</th>
                        <th>Foto Profil</th>
                        <th>Email</th>
                        <th>Password</th>
                        <th>Status</th>
                        <th>Telepon</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="userTable">
                    <!-- Data pengguna akan dimuat di sini -->
                </tbody>
            </table>
            <p class="empty-message" id="emptyUserMessage">Tidak ada data pengguna.</p>
        </div>
        
        <div class="header">
          <h2>Admin</h2>
      </div>
      <div class="content">
          <div class="loader" id="adminLoader"></div>
          <table>
              <thead>
                  <tr>
                      <th>Email</th>
                      <th>Password</th>
                      <th>Action</th>
                  </tr>
              </thead>
              <tbody id="adminTable">
                  <!-- Data admin akan dimuat di sini -->
              </tbody>
          </table>
          <p class="empty-message" id="emptyAdminMessage">Tidak ada data admin.</p>
      </div>

      <div class="header">
          <h2>Petugas</h2>
      </div>
      <div class="content">
          <div class="loader" id="petugasLoader"></div>
          <table>
              <thead>
                  <tr>
                      <th>Email</th>
                      <th>Password</th>
                      <th>Action</th>
                  </tr>
              </thead>
              <tbody id="petugasTable">
                  <!-- Data admin akan dimuat di sini -->
              </tbody>
          </table>
          <p class="empty-message" id="emptyPetugasMessage">Tidak ada data petugas.</p>
      </div>


        <div class="header">
            <h2>Laporan</h2>
        </div>
        <div class="content">
            <div class="loader" id="laporanLoader"></div>
            <table>
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>Foto Kejadian</th>
                        <th>Email</th>
                        <th>Jenis Permasalahan</th>
                        <th>Catatan Permasalahan</th>
                        <th>Lokasi</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="laporanTable">
                    <!-- Data laporan akan dimuat di sini -->
                </tbody>
            </table>
            <p class="empty-message" id="emptyLaporanMessage">Tidak ada data laporan.</p>
        </div>
    </div>
    

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-auth.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBmB3ffMDy0uRCSMLL0cCIrjqRWdWOMF4&callback=initMap" async defer></script>

    
    <script>
      // Konfigurasi Firebase
      var firebaseConfig = {
        apiKey: "AIzaSyARIl9jxFBTQ__EqSs6tLXuA6E2Y6vSxGI",
        authDomain: "halo-merah.firebaseapp.com",
        databaseURL: "https://halo-merah-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "halo-merah",
        storageBucket: "halo-merah.appspot.com",
        messagingSenderId: "228951531440",
        appId: "1:228951531440:web:481e8c884457ac20938075",
        measurementId: "G-Z6H4NV9PQ6"
      };

      // Inisialisasi Firebase
      firebase.initializeApp(firebaseConfig);

      // Referensi Firebase untuk pengguna dan laporan
      var usersRef = firebase.database().ref('users');
      var laporanRef = firebase.database().ref('laporan');
      var petugasRef = firebase.database().ref('petugas');
      var adminRef = firebase.database().ref('admin');
      var uploadsRef = firebase.database().ref('uploads');
      

      let map, marker, directionsService, directionsRenderer;

    function initMap() {
        // Lokasi default (misalnya Jayapura)
        var jayapura = { lat: -2.5391, lng: 140.7014 };

        // Inisialisasi peta di elemen dengan ID "map-container"
        map = new google.maps.Map(document.getElementById('map-container'), {
            zoom: 14,
            center: jayapura,
            mapTypeId: google.maps.MapTypeId.SATELLITE
        });

        // Inisialisasi marker dengan posisi default (Jayapura)
        marker = new google.maps.Marker({
            position: jayapura,
            map: map,
            title: "Lokasi Default (Jayapura)"
        });

    // Inisialisasi Directions Service dan Directions Renderer
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer();
    directionsRenderer.setMap(map);

    // Cek lokasi terkini pengguna menggunakan Geolocation API
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
            var currentLocation = {
                lat: position.coords.latitude,
                lng: position.coords.longitude
            };

            // Cek akurasi lokasi
            var accuracy = position.coords.accuracy;
            console.log("Akurasi lokasi: " + accuracy + " meters");

            // Pusatkan peta ke lokasi pengguna
            map.setCenter(currentLocation);

            // Perbarui marker dengan lokasi pengguna
            marker.setPosition(currentLocation);
            marker.setTitle("Lokasi Terkini");

        }, function () {
            alert("Lokasi Anda tidak dapat diakses. Menggunakan lokasi default.");
        }, {
            enableHighAccuracy: true,  // Meminta lokasi yang lebih akurat
            timeout: 10000,  // Waktu tunggu maksimal (10 detik)
            maximumAge: 0  // Jangan menggunakan lokasi yang disimpan sebelumnya
        });
    } else {
        alert("Geolocation tidak didukung oleh browser ini. Menggunakan lokasi default.");
    }
    // Tangani proses logout
    document.getElementById('logout').addEventListener('click', function(e) {
        e.preventDefault();  // Mencegah pengalihan default

        firebase.auth().signOut()
            .then(() => {
                // Logout berhasil, arahkan ke halaman login
                window.location.href = 'index.html';  // Ganti dengan URL halaman login Anda
            })
            .catch((error) => {
                console.error("Gagal logout: ", error);
                alert("Gagal logout. Silakan coba lagi.");
            });
    });

    // Tombol untuk menampilkan lokasi berdasarkan input latitude dan longitude gabungan
    document.getElementById('show-location').addEventListener('click', function () {
        var coordinatesInput = document.getElementById('coordinates').value.trim();

        if (!coordinatesInput) {
            alert('Silakan masukkan koordinat dalam format "latitude, longitude".');
            return;
        }

        // Pisahkan latitude dan longitude dari input
        var coordinates = coordinatesInput.split(',').map(coord => parseFloat(coord.trim()));
        if (coordinates.length !== 2 || isNaN(coordinates[0]) || isNaN(coordinates[1])) {
            alert('Format koordinat tidak valid. Contoh yang benar: "-2.5929256017726425, 140.63904605805874".');
            return;
        }

        var newLocation = { lat: coordinates[0], lng: coordinates[1] };

        // Pindahkan marker ke lokasi baru
        marker.setPosition(newLocation);
        map.setCenter(newLocation);
    });

    // Tombol untuk menghapus input koordinat
    document.getElementById('clear-location').addEventListener('click', function () {
        document.getElementById('coordinates').value = '';  // Mengosongkan input
        marker.setPosition(jayapura);  // Kembalikan marker ke lokasi default
        map.setCenter(jayapura);  // Pusatkan peta ke lokasi default
    });

      // Tombol untuk menampilkan rute ke lokasi yang dipin
      document.getElementById('route-location').addEventListener('click', function () {
      if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function (position) {
              var origin = new google.maps.LatLng(position.coords.latitude, position.coords.longitude); // Lokasi pengguna
              var destination = marker.getPosition(); // Lokasi tujuan (marker)

              var request = {
                  origin: origin,
                  destination: destination,
                  travelMode: google.maps.TravelMode.DRIVING
              };

              directionsService.route(request, function (response, status) {
                  if (status == google.maps.DirectionsStatus.OK) {
                      directionsRenderer.setDirections(response);

                      // Ambil informasi jarak dan durasi dari response
                      var route = response.routes[0].legs[0];
                      var distanceText = route.distance.text; // Jarak dalam km/m
                      var durationText = route.duration.text; // Estimasi waktu tempuh

                      document.getElementById('distance-info').innerText =
                          `Jarak: ${distanceText} | Waktu tempuh: ${durationText}`;
                  } else {
                      alert('Tidak dapat menampilkan rute: ' + status);
                  }
              });
          }, function () {
              alert("Lokasi Anda tidak dapat diakses.");
          });
      } else {
          alert("Geolocation tidak didukung oleh browser ini.");
      }
  });
  }

      // Memuat peta saat halaman dimuat
          window.onload = initMap;


      
      // Fungsi untuk mendapatkan semua data pengguna
      function getUsers() {
        var userLoader = document.getElementById('userLoader');
        userLoader.style.display = 'block';

        // Gunakan listener on('value') untuk mendengarkan perubahan data
        usersRef.on('value', function(snapshot) {
          var users = snapshot.val();
          var userTable = document.getElementById('userTable');
          var emptyUserMessage = document.getElementById('emptyUserMessage');
          userTable.innerHTML = ''; // Bersihkan tabel sebelum mengisinya lagi
          var rows = '';
          var isEmpty = true;
          for (var key in users) {
            if (users.hasOwnProperty(key)) {
              var user = users[key];
              var fotoURL = user.profileImageUrl || '';
              var fotoTag = fotoURL ? `<img src="${fotoURL}" alt="Foto" style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;">`: 'Tidak ada foto';
              rows += `<tr>
                          <td>${user.displayName || 'None'}</td>
                          <td>${fotoTag}</td>
                          <td>${user.email || 'None'}</td>
                          <td>${user.password || 'None'}</td>
                          <td>${user.status || 'None'}</td>
                          <td>${user.telepon || 'None'}</td>
                          <td class="action-buttons">
                              <button onclick="editUser('${key}')">Edit</button>
                              <button class="delete" onclick="deleteUser('${key}')">Delete</button>
                          </td>
                        </tr>`;
              isEmpty = false;
            }
          }
                userTable.innerHTML = rows;
                userLoader.style.display = 'none';
                if (isEmpty) {
                  emptyUserMessage.style.display = 'block';
                } else {
                  emptyUserMessage.style.display = 'none';
                }
              }, function(error) {
                console.error("Error fetching users:", error);
                userLoader.style.display = 'none';
              });
            }
            function deleteUser(key) {
        if (!key) {
          alert("ID pengguna tidak ditemukan.");
          return;
        }

        if (confirm("Yakin ingin menghapus pengguna ini?")) {
          firebase.database().ref('users/' + key).remove()
            .then(() => {
              alert("Pengguna berhasil dihapus.");
              getUsers(); // Refresh data setelah penghapusan
            })
            .catch((error) => {
              console.error("Gagal menghapus pengguna:", error);
              alert("Gagal menghapus pengguna. Cek console untuk detail.");
            });
        }
      }
      function getAdmin() {
              var adminLoader = document.getElementById('adminLoader');
              adminLoader.style.display = 'block';

              // Gunakan listener on('value') untuk mendengarkan perubahan data
              adminRef.on('value', function(snapshot) {
                var admins = snapshot.val();
                var adminTable = document.getElementById('adminTable');
                var emptyAdminMessage = document.getElementById('emptyAdminMessage');
                adminTable.innerHTML = ''; // Bersihkan tabel sebelum mengisinya lagi
                var rows = '';
                var isEmpty = true;
                for (var key in admins) {
                  if (admins.hasOwnProperty(key)) {
                    var admin = admins[key];
                    rows += `<tr>
                                <td>${admin.email || 'None'}</td>
                                <td>${admin.password || 'None'}</td>
                                <td class="action-buttons">
                                    <button onclick="editAdmin('${key}')">Edit</button>
                                    <button class="delete" onclick="deleteAdmin('${key}')">Delete</button>
                                </td>
                              </tr>`;
                    isEmpty = false;
                  }
                }
                adminTable.innerHTML = rows;
                adminLoader.style.display = 'none';
                if (isEmpty) {
                  emptyAdminMessage.style.display = 'block';
                } else {
                  emptyAdminMessage.style.display = 'none';
                }
              }, function(error) {
                console.error("Error fetching admins:", error);
                adminLoader.style.display = 'none';
              });
            }
            function deleteAdmin(key) {
              if (!key) {
                alert("ID admin tidak ditemukan.");
                return;
              }

              // Ambil semua data admin terlebih dahulu
              firebase.database().ref('admin').once('value')
                .then((snapshot) => {
                  const admins = snapshot.val();
                  const adminKeys = Object.keys(admins);

                  // Jika hanya satu admin, batalkan penghapusan
                  if (adminKeys.length <= 1) {
                    alert("Tidak bisa menghapus. Setidaknya harus ada satu akun admin yang tersisa.");
                    return;
                  }

                  // Konfirmasi sebelum menghapus
                  if (confirm("Yakin ingin menghapus admin ini?")) {
                    firebase.database().ref('admin/' + key).remove()
                      .then(() => {
                        alert("Admin berhasil dihapus.");
                        getAdmin(); // Refresh data
                      })
                      .catch((error) => {
                        console.error("Gagal menghapus admin:", error);
                        alert("Gagal menghapus admin. Cek console untuk detail.");
                      });
                  }
                })
                .catch((error) => {
                  console.error("Gagal mengambil data admin:", error);
                  alert("Terjadi kesalahan saat mengambil data admin.");
                });
            }



        function getPetugas() {
            var petugasLoader = document.getElementById('petugasLoader');
            var petugasTable = document.getElementById('petugasTable');
            var emptyPetugasMessage = document.getElementById('emptyPetugasMessage');

            petugasLoader.style.display = 'block'; // Tampilkan loader

            petugasRef.on('value', function(snapshot) {
                var petugasData = snapshot.val();
                petugasTable.innerHTML = ''; // Kosongkan tabel
                var isEmpty = true;

                if (petugasData) {
                    for (var key in petugasData) {
                        if (petugasData.hasOwnProperty(key)) {
                            var petugas = petugasData[key];
                            var row = `
                                <tr>
                                    <td>${petugas.email || '-'}</td>
                                    <td>${petugas.password || '-'}</td>
                                    <td class="action-buttons">
                                        <button onclick="editPetugas('${key}')">Edit</button>
                                        <button class="delete" onclick="deletePetugas('${key}')">Delete</button>
                                    </td>
                                </tr>
                            `;
                            petugasTable.innerHTML += row;
                            isEmpty = false;
                        }
                    }
                }

                petugasLoader.style.display = 'none'; // Sembunyikan loader

                if (isEmpty) {
                    emptyPetugasMessage.style.display = 'block';
                } else {
                    emptyPetugasMessage.style.display = 'none';
                }
            }, function(error) {
                console.error("Error fetching petugas:", error);
                petugasLoader.style.display = 'none';
            });
        }

// Fungsi untuk hapus data petugas
          function deletePetugas(key) {
              if (!key) {
                  alert("ID petugas tidak ditemukan.");
                  return;
              }

              if (confirm("Yakin ingin menghapus petugas ini?")) {
                  firebase.database().ref('petugas/' + key).remove()
                      .then(() => {
                          alert("Petugas berhasil dihapus.");
                      })
                      .catch((error) => {
                          console.error("Gagal menghapus petugas:", error);
                          alert("Gagal menghapus petugas. Lihat console untuk detail.");
                      });
              }
          }

  // Fungsi untuk mendapatkan semua data laporan
      function getLaporan() {
  var laporanLoader = document.getElementById('laporanLoader');
  laporanLoader.style.display = 'block';

  laporanRef.on('value', function(snapshot) {
    var laporans = snapshot.val();
    var laporanTable = document.getElementById('laporanTable');
    var emptyLaporanMessage = document.getElementById('emptyLaporanMessage');
    laporanTable.innerHTML = ''; // Bersihkan tabel sebelum mengisinya lagi
    var rows = '';
    var isEmpty = true;

    if (laporans) {
      // Ambil semua key dan urutkan berdasarkan timestamp DESC (terbaru di atas)
      var sortedKeys = Object.keys(laporans).sort(function(a, b) {
        var tA = laporans[a].timestamp || 0;
        var tB = laporans[b].timestamp || 0;
        return tB - tA; // Urutkan descending
      });

      sortedKeys.forEach(function(key) {
        var laporan = laporans[key];

        // Format waktu
        var timestamp = laporan.timestamp ? new Date(laporan.timestamp).toLocaleString() : 'None';

        // Menampilkan foto jika ada
        var foto = laporan.fotoK ? `<img src="${laporan.fotoK}" alt="Foto Kejadian" style="width:100px; height:100px; object-fit:cover; border-radius:5px;">` : 'Tidak ada foto';

        // Menambahkan baris ke tabel sesuai urutan kolom
        rows += `<tr>
                    <td>${timestamp}</td>
                    <td>${foto}</td>
                    <td>${laporan.Email || 'None'}</td>
                    <td>${laporan['Jenis Permasalahan'] || 'None'}</td>
                    <td>${laporan['Catatan Permasalahan'] || 'None'}</td>
                    <td>${laporan.Location || 'None'}</td>
                    <td>${laporan.Status || 'None'}</td>
                    <td class="action-buttons">
                        <button onclick="editLaporan('${key}')">Edit</button>
                        <button onclick="SedangProses('${key}')">Proses</button>
                        <button class="delete" onclick="deleteLaporan('${key}')">Delete</button>
                        <button class="salin" onclick="salinLokasi('${laporan.Location}')">Salin Lokasi</button>
                    </td>
                  </tr>`;
        isEmpty = false;
      });
    }

    laporanTable.innerHTML = rows;
    laporanLoader.style.display = 'none';
    if (isEmpty) {
      emptyLaporanMessage.style.display = 'block';
    } else {
      emptyLaporanMessage.style.display = 'none';
    }
  }, function(error) {
    console.error("Error fetching laporans:", error);
    laporanLoader.style.display = 'none';
  });
}

     


      //hapus data
      function deleteLaporan(key) {
        const konfirmasi = confirm("Apakah kamu yakin ingin menghapus laporan ini?");
        if (konfirmasi) {
          laporanRef.child(key).remove()
            .then(() => {
              alert("Laporan berhasil dihapus.");
            })
            .catch((error) => {
              console.error("Gagal menghapus laporan:", error);
              alert("Terjadi kesalahan saat menghapus laporan.");
            });
        }
      }

      function SedangProses(key) {
  // Mengubah status laporan menjadi "Sedang Diproses"
  laporanRef.child(key).update({ Status: 'Sedang Diproses' })
    .then(() => {
      const statusCell = document.getElementById(`status-${key}`);
      if (statusCell) {
        statusCell.textContent = 'Sedang Diproses';
      }

      alert("Status berhasil diubah menjadi 'Sedang Diproses'.");
    })
    .catch(err => {
      console.error("Terjadi kesalahan:", err);
      alert("Terjadi kesalahan: " + err.message);
    });
}






        function salinLokasi(lokasi) {
          // Cek apakah lokasi ada dan valid
          if (lokasi) {
            navigator.clipboard.writeText(lokasi).then(function() {
              // Beri notifikasi jika lokasi berhasil disalin
              alert('Lokasi berhasil disalin: ' + lokasi);
            }).catch(function(error) {
              // Jika terjadi kesalahan
              alert('Gagal menyalin lokasi: ' + error);
            });
          } else {
            alert('Lokasi tidak tersedia');
          }
        }


      // Fungsi untuk mengarahkan ke halaman edit user
      function editUser(userId) {
        window.location.href = `user.html?id=${userId}`;
      }

      // Fungsi untuk mengarahkan ke halaman edit laporan
      function editLaporan(laporanId) {
        window.location.href = `laporan.html?id=${laporanId}`;
      }

       // Fungsi untuk mengarahkan ke halaman edit admin
       function editAdmin(AdminId) {
        window.location.href = `admin.html?id=${AdminId}`;
      }

      function editPetugas(id) {
    // Arahkan ke halaman edit petugas, dengan membawa ID petugas sebagai query parameter
          window.location.href = `petugas.html?id=${id}`;
      }

      
      function getUploads() {
      uploadsRef.on('value', function(snapshot) {
        var uploads = snapshot.val();
        var scrollMenu = document.querySelector('.scroll-menu');
        scrollMenu.innerHTML = ''; // Bersihkan konten sebelumnya

        var isEmpty = true;
        var uploadArray = [];

        // Simpan semua upload ke dalam array
        for (var key in uploads) {
          if (uploads.hasOwnProperty(key)) {
            var upload = uploads[key];
            uploadArray.push({ ...upload, key: key }); // Tambahkan key ke setiap upload
          }
        }
        

    // Balik urutan array upload
    uploadArray.reverse();

    // Tambahkan elemen baru ke scroll-menu
    for (var i = 0; i < uploadArray.length; i++) {
      var upload = uploadArray[i];
      var photoURL = upload.photoURL || 'https://via.placeholder.com/150'; // Gunakan placeholder jika tidak ada gambar
      var note = upload.note || 'Tidak ada keterangan';
      var key = upload.key; // Ambil key untuk digunakan pada tombol hapus

      var scrollItem = `
        <div class="scroll-item">
          <img src="${photoURL}" alt="Gambar">
          <p>${note}</p>
          <button class="delete-button" data-key="${key}" style="display: none;">Hapus</button>
        </div>
      `;
      scrollMenu.innerHTML += scrollItem;
      isEmpty = false;
    }

    if (isEmpty) {
      scrollMenu.innerHTML = '<p class="empty-message">Tidak ada gambar yang diunggah.</p>';
    } else {
      // Tampilkan tombol hapus setelah gambar dimuat
      var imageElements = document.querySelectorAll('.scroll-item img');
      imageElements.forEach(function(imageElement) {
        showDeleteButton(imageElement);
      });
    }

    // Tambahkan event listener untuk tombol hapus
    var deleteButtons = document.querySelectorAll('.delete-button');
    deleteButtons.forEach(function(button) {
      button.addEventListener('click', function() {
        var key = this.getAttribute('data-key'); // Ambil key dari data attribute
        // Hapus item dari Firebase
        uploadsRef.child(key).remove().then(() => {
          console.log("Upload deleted successfully.");
          getUploads(); // Panggil kembali untuk memperbarui tampilan
        }).catch((error) => {
          console.error("Error deleting upload:", error);
        });
      });
    });
  }, function(error) {
    console.error("Error fetching uploads:", error);
  });
}

function showDeleteButton(imageElement) {
  // Ambil tombol yang berada di dalam elemen scroll-item yang sama dengan gambar
  var deleteButton = imageElement.parentElement.querySelector('button');
  // Tampilkan tombol setelah gambar selesai dimuat
  deleteButton.style.display = 'block';
}



      // Fungsi untuk memuat data saat halaman dimuat
      window.onload = function() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            getUsers();
            getLaporan();
            getAdmin();
            getPetugas();
            getUploads();
          } else {
            console.log("No user is signed in.");
            // Anda bisa mengarahkan pengguna ke halaman login di sini jika diperlukan
          }
        });
      };
    </script>
</body>
</html>